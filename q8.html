<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>N-Queens Step-by-Step Visualization</title>
<style>
  body {
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
   background: linear-gradient(135deg, #1d2671, #c33764); /* Sky background */
    height: 100vh;
    margin: 0;
    overflow: hidden;
  }
  h1 { color: #333333; margin-bottom: 20px; text-shadow: 1px 1px #fff; }
  .controls { margin-bottom: 20px; }
  select, button { 
    padding: 10px 20px; font-size: 16px; margin: 5px; 
    border-radius: 8px; border: none; cursor: pointer; 
  }
  button { background:#ff416c; color:#fff; font-weight:bold; }
  button:hover { background:#ff4b2b; }
  .chessboard {
    display: grid;
    grid-template-columns: repeat(var(--n), 60px);
    grid-template-rows: repeat(var(--n), 60px);
    gap: 2px;
    margin-top: 20px;
    position: relative;
  }
  .cell {
    width: 60px;
    height: 60px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 36px;
    transition: all 0.5s;
    position: relative;
    border-radius: 5px;
  }
  .white { background-color: #fff; }
  .black { background-color: #000; color: #fff; }
  .highlight { background-color: rgba(183, 255, 0, 0.3) !important; }
  .backtrack { background-color: rgba(0,0,255,0.3) !important; }
  .current { box-shadow: 0 0 15px 5px yellow inset; }
  .redcross { color: red; font-size: 28px; position: absolute; }
  .confetti { position: fixed; width: 10px; height: 10px; background: #ff0; top: 0; animation: fall 3s linear forwards; z-index: 9999; }
  @keyframes fall { 0% { transform: translateY(0) rotate(0deg); } 100% { transform: translateY(100vh) rotate(360deg); opacity:0; } }
</style>
</head>
<body>

<h1>N-Queens Step-by-Step Visualization</h1>

<div class="controls">
  <label>Queens: </label>
  <select id="queenCount">
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
    <option value="7">7</option>
    <option value="8" selected>8</option>
  </select>
  <button id="nextBtn" disabled>Next Step</button>
  <button id="autoBtn" disabled>Auto Solve</button>
  <button id="resetBtn">Reset</button>
</div>

<div id="board" class="chessboard"></div>

<script>
let N = parseInt(document.getElementById('queenCount').value);
document.documentElement.style.setProperty('--n', N);

const boardDiv = document.getElementById('board');
let board = Array.from({length:N}, () => Array(N).fill(0));
let steps = [];
let stepIndex = 0;
let autoInterval = null;
let confettiInterval = null;

// Render board
function renderBoard(highlightCells=[], backtrackCells=[], currentCell=null, invalidCells=[]){
  boardDiv.innerHTML='';
  for(let i=0;i<N;i++){
    for(let j=0;j<N;j++){
      const cell=document.createElement('div');
      cell.className='cell '+((i+j)%2===0?'white':'black');
      if(board[i][j]===1) cell.textContent='♛';
      if(highlightCells.some(([x,y])=>x===i && y===j)) cell.classList.add('highlight');
      if(backtrackCells.some(([x,y])=>x===i && y===j)) cell.classList.add('backtrack');
      if(currentCell && currentCell[0]===i && currentCell[1]===j) cell.classList.add('current');
      if(invalidCells.some(([x,y])=>x===i && y===j)){
        const cross=document.createElement('span');
        cross.className='redcross';
        cross.textContent='✖';
        cell.appendChild(cross);
      }
      boardDiv.appendChild(cell);
    }
  }
}

// Create confetti
function createConfetti() {
  const confetti = document.createElement('div');
  confetti.className='confetti';
  confetti.style.background=`hsl(${Math.random()*360},100%,50%)`;
  confetti.style.left=Math.random()*window.innerWidth+'px';
  confetti.style.width = confetti.style.height = 5 + Math.random()*10 + 'px';
  confetti.style.animationDuration = 2 + Math.random()*2 + 's';
  document.body.appendChild(confetti);
  setTimeout(()=>confetti.remove(),4000);
}

function startConfetti() {
  if(confettiInterval) clearInterval(confettiInterval);
  confettiInterval = setInterval(createConfetti, 150);
}

// N-Queens solver with step recording
function solveNQueens(row=0){
  if(row===N){
    steps.push({board: JSON.parse(JSON.stringify(board)), highlights: [], backtrack: [], current: null, invalid: []});
    return true;
  }
  for(let col=0; col<N; col++){
    const highlights = getAttackCells(row,col);
    const invalid = [];
    for(let c=0;c<N;c++) if(!isSafe(row,c)) invalid.push([row,c]);
    steps.push({board: JSON.parse(JSON.stringify(board)), highlights, backtrack: [], current: [row,col], invalid});
    if(isSafe(row,col)){
      board[row][col]=1;
      steps.push({board: JSON.parse(JSON.stringify(board)), highlights, backtrack: [], current: [row,col], invalid});
      if(solveNQueens(row+1)) return true;
      board[row][col]=0;
      steps.push({board: JSON.parse(JSON.stringify(board)), highlights: [], backtrack:[[row,col]], current: null, invalid});
    }
  }
  return false;
}

function isSafe(row,col){
  for(let i=0;i<row;i++) if(board[i][col]===1) return false;
  for(let i=row,j=col;i>=0&&j>=0;i--,j--) if(board[i][j]===1) return false;
  for(let i=row,j=col;i>=0&&j<N;i--,j++) if(board[i][j]===1) return false;
  return true;
}

function getAttackCells(row,col){
  const cells=[];
  for(let i=0;i<N;i++) cells.push([row,i],[i,col]);
  for(let i=row,j=col;i>=0&&j>=0;i--,j--) cells.push([i,j]);
  for(let i=row,j=col;i>=0&&j<N;i--,j++) cells.push([i,j]);
  for(let i=row,j=col;i<N&&j<N;i++,j++) cells.push([i,j]);
  for(let i=row,j=col;i<N&&j>=0;i++,j--) cells.push([i,j]);
  return cells;
}

// Step control
function nextStep(){
  if(stepIndex>=steps.length){ startConfetti(); return; }
  const {board:b, highlights, backtrack, current, invalid}=steps[stepIndex];
  board=b;
  renderBoard(highlights, backtrack, current, invalid);
  stepIndex++;
}

// Auto solve
function autoSolve(){
  if(autoInterval) clearInterval(autoInterval);
  autoInterval = setInterval(()=>{
    nextStep();
    if(stepIndex>=steps.length) clearInterval(autoInterval);
  }, 500);
}

// Reset
function resetBoard(){
  if(autoInterval) clearInterval(autoInterval);
  if(confettiInterval) clearInterval(confettiInterval);
  confettiInterval = null;
  document.querySelectorAll('.confetti').forEach(c => c.remove());
  
  N = parseInt(document.getElementById('queenCount').value);
  document.documentElement.style.setProperty('--n', N);
  board = Array.from({length:N}, () => Array(N).fill(0));
  steps = []; stepIndex = 0;
  renderBoard();
  document.getElementById('nextBtn').disabled = false;
  document.getElementById('autoBtn').disabled = false;
}

// Event listeners
document.getElementById('queenCount').addEventListener('change', resetBoard);
document.getElementById('nextBtn').addEventListener('click', ()=>{
  if(steps.length===0){ steps=[]; stepIndex=0; board=Array.from({length:N},()=>Array(N).fill(0)); solveNQueens(); }
  nextStep();
});
document.getElementById('autoBtn').addEventListener('click', ()=>{
  if(steps.length===0){ steps=[]; stepIndex=0; board=Array.from({length:N},()=>Array(N).fill(0)); solveNQueens(); }
  autoSolve();
});
document.getElementById('resetBtn').addEventListener('click', resetBoard);

// Initial render
resetBoard();
</script>
</body>
</html>
